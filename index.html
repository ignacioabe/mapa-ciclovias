<!DOCTYPE html>
<html lang="en">

  <head>

  <meta charset="UTF-8">
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

  <title>
      SANTIAGO PEDALEABLE
  </title>

<!--leaflet-->
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
<script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>

<!--favicon-->
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
<link rel="icon" href="/favicon.ico" type="image/x-icon">

  <style type="text/css">
  body {
      padding: 0;
      margin: 0;
  }
  html, body, #map {
      height: 100%;
  }
  </style>

</head>

<div id="map"></div>


<!-- leaflet markercluster -->

<!--
<link rel="stylesheet" href="http://rawgit.com/Leaflet/Leaflet.markercluster/master/dist/MarkerCluster.Default.css" />
<script src="http://rawgit.com/Leaflet/Leaflet.markercluster/master/dist/leaflet.markercluster.js"></script>
-->

<!-- leaflet ajax -->

<script src="http://calvinmetcalf.github.io/leaflet-ajax/dist/leaflet.ajax.js"></script>

<!-- leaflet maki markers -->

<!--
<script src="http://rawgit.com/jseppi/Leaflet.MakiMarkers/master/Leaflet.MakiMarkers.js"></script>
-->

</div>

<script>

// la gran lata de este sistema es que hay que exportar tres archivos separados
// desde overpass.turbo

// ESTILO PUNTOS

//estilo bicicleteros
var estiloPark = {
    radius: 4,
    fillColor: "#1c1",
    color: "#1c1",
    weight: 1.5,
    opacity: 1,
    fillOpacity: 0.5
};

//estilo bicicletas públicas
var estiloRent = {
    radius: 8,
    fillColor: "#f33",
    color: "#f33",
    weight: 1.5,
    opacity: 1,
    fillOpacity: 0.5
};

//estilo talleres
var estiloShop = {
    radius: 8,
    fillColor: "#459dff",
    color: "#459dff",
    weight: 1.5,
    opacity: 1,
    fillOpacity: 0.5
};



// DATOS PUNTOS

//layer bicicleteros
var biciPark = new L.GeoJSON.AJAX("./geodatos-osm/bici-park.geojson", {

pointToLayer: function (feature, latlng) {
        return L.circleMarker(latlng);
    }
,
onEachFeature:function (feature, layer) {
layer.bindPopup(
  "<b>NOMBRE:</b> " + feature.properties.name +
  "<br><b>Capacidad:</b> " + feature.properties.capacity
  );
}
,style: estiloPark});

//layer bicicletas públicas
var biciRent = new L.GeoJSON.AJAX("./geodatos-osm/bici-rent.geojson", {

pointToLayer: function (feature, latlng) {
        return L.circleMarker(latlng);
    }
,
onEachFeature:function (feature, layer) {
layer.bindPopup(
  "<b>NOMBRE:</b> " + feature.properties.name +
  "<br><b>Capacidad:</b> " + feature.properties.capacity +
  "<br><b>Operador:</b> " + feature.properties.operator
  );
}
,style: estiloRent});

//layer talleres
//me gustaría poner las direcciones pero tengo problemas con los keys compuestos
//ej addr:street=
var biciShop = new L.GeoJSON.AJAX("./geodatos-osm/bici-shop.geojson", {

pointToLayer: function (feature, latlng) {
        return L.circleMarker(latlng);
    }
,
onEachFeature:function (feature, layer) {
layer.bindPopup(
  "<b>NOMBRE:</b> " + feature.properties.name
  );
}
,style: estiloShop});

// ESTILO CICLOVÍAS

var myStyle = {
    "color": "#3BDB2A",
    "weight": 5,
    "opacity": 0.65
};

// DATOS CICLOVÍAS (añadir las ciclovías primero, sacar lo que ya ni sirve después)

var cicloviasGeojson = new L.GeoJSON.AJAX("./geodatos-osm/ciclovias.geojson", {
  style: function(feature) {
    switch (feature.properties.oneway) {
      case "yes": return {color: "#ff0000"};
      case "no": return {color: "#0000ff"};
      default: return {color: "#00ff00"};
    }
  }
});

//respaldo base clara
//var base_cl		= L.tileLayer('http://{s}.tiles.mapbox.com/v3/ignacioabe.j74kak2h/{z}/{x}/{y}.png'),
//http://otile[1234].mqcdn.com/tiles/1.0.0/osm/zoom/x/y.jpg

var base_cl		= L.tileLayer('http://{s}.tiles.mapbox.com/v3/ignacioabe.j74kak2h/{z}/{x}/{y}.png'),
    base_os		= L.tileLayer('http://{s}.tiles.mapbox.com/v3/ignacioabe.map-srs3by8q/{z}/{x}/{y}.png'),
    strava		= L.tileLayer('http://globalheat.strava.com/tiles/both/color1/{z}/{x}/{y}.png', {opacity: 0.5, attribution:'<a href="http://labs.strava.com/heatmap/">strava heatmap</a>'}),
    ciclovias	= L.tileLayer('http://{s}.tiles.mapbox.com/v3/ignacioabe.stgo-ciclovias/{z}/{x}/{y}.png');

var map = L.map('map', {
    center: [-33.435, -70.635],
    zoom: 15,
    layers: [base_cl, cicloviasGeojson]
});

var baseMaps = {
    "base_clara": base_cl,
    "base_oscura": base_os
};

var overlayMaps = {
    "flujos (strava)": strava,
    "__ciclovias_geojson": cicloviasGeojson,
    "__bici_est": biciPark,
    "__bici_pub": biciRent,
    "__bici_shop": biciShop
};

L.control.layers(baseMaps, overlayMaps).addTo(map);

map.locate({setView: true, maxZoom: 15});

</script>
